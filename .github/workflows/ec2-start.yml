name: Start EC2

on: workflow_dispatch

jobs:
  start:
    runs-on: ubuntu-latest

    steps:
      - name: AWS cli install action
        uses: chrislennon/action-aws-cli@1.1
      - run: aws ec2 start-instances --instance-ids i-04e405d4180419140
        env:
          AWS_ACCESS_KEY_ID: AKIAXVSCAOY35STDOI6I
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SK }}
          AWS_DEFAULT_REGION: cn-northwest-1
      - run: |
          export ip=$(aws ec2 describe-instances --instance-ids i-04e405d4180419140 | grep -oP '(?<="PublicIpAddress": ")[^"]*')
          echo "INSTANCE_IP=$ip" >> $GITHUB_ENV
        env:
          AWS_ACCESS_KEY_ID: AKIAXVSCAOY35STDOI6I
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SK }}
          AWS_DEFAULT_REGION: cn-northwest-1
      - uses: wangsijie/feishu-bot@v1
        with:
          uuid: 84f845a6-ae62-4fbb-b136-96c3817dca4d
          text: ${{ env.INSTANCE_IP }}
